{% extends "measure_ambiguity/Task.html" %}
{% load otree static %}

{% block scripts %}
    {{ block.super }}

    <script>
        $('.draw').on('click', function () {
            (async () => {
                // disable the buttons
                $(".draw").prop('disabled', true);

                // draw a ball and get the colour
                const colourDrawn = await blower.drawBall();

                // put the colour name and amount in the html
                $('#ballDrawnColour').html(colourDrawn.colourHuman);
                console.log('sending the data!')
                liveSend(colourDrawn.colourHuman);
            })();
        });
    </script>

{% endblock %}

{% block styles %}
    {{ block.super }}
    <style>

        .frac {
            display: inline-block;
            position: relative;
            vertical-align: middle;
            letter-spacing: 0.001em;
            text-align: center;
        }

        .frac > span {
            display: block;
            padding: 0.1em;
        }

        .frac span.bottom {
            border-top: thin solid black;
        }

        .frac span.symbol {
            display: none;
        }

        .choice-A-B-buttons {
            pointer-events: none;
        }


    </style>
{% endblock %}

{% block title %}
{% endblock %}

{% block content %}

    <div class="card">
        <h2 class="card-header">Payment</h2>
        <div class="card-body">
            <div class="container">
                <div class="row">
                    <div class="col-8">
                        <p class="card-text">
                            The question selected for your payment is:
                        </p>
                    </div>
                    <div class="col">
                        <p class="card-text font-weight-bold">
                            Question {{ player.question_to_pay }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body">

            {% include 'measure_ambiguity/includes/ChoiceTask.html' %}

        </div>
        <div class="card-body">
            <div class="container px-0">
                <div class="row">
                    <div class="col-8">
                        <p class="card-text">
                            The line selected for your payment, starting from the top, is:
                        </p>
                    </div>
                    <div class="col">
                        <p class="card-text font-weight-bold">
                            Line {{ player.line_to_pay }}
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-8">
                        <p class="card-text">
                            On that line, you chose:
                        </p>
                    </div>
                    <div class="col">
                        <p class="card-text font-weight-bold">
                            Option {{ choice_at_line_to_pay }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="card-text">
                Therefore, how much you win depends
                {% if payment_type == 'lottery' %}
                    on the lottery and thus on the random number generated by the computer.
                {% elif  payment_type == 'blower' %}
                    on the ball drawn by the blower.
                {% elif payment_type == 'DOW' %}
                    on the evolution of the Dow
                {% endif %}
            </div>
            {% if payment_type == 'lottery' %}
                <ul class="card-text">
                    <li>
                        If the number drawn by the computer is between 0 and {{ win_cutoff }}, you will win {{ Constants.payoff|c }}.
                    </li>
                    <li>
                        If the number drawn by the computer is between {{ win_cutoff|add:1 }} and 100, you will win {{ 0|c }}.
                    </li>
                </ul>
                <div class="container px-0">
                    <div class="row mt-3 card-text">
                        <div class="col-8">
                            The random number generated by the computer is:
                        </div>
                        <div class="col font-weight-bold">
                            {{ draw }}
                        </div>
                    </div>
                </div>
            {% elif payment_type == 'blower' %}
                <div class="card-text">
                    If the colour of the ball drawn from the Bingo-Blower is one of these, you will win {{ Constants.payoff|c }}:
                        </div>
                        <div class="wrapper d-flex justify-content-center align-items-end p-0 m-0">
                        <div class="cell">
                        <span class="state-1 {% if state.0 %} ball {% endif %}"></span>
                        </div>
                        <div class="cell">
                        <div class="state-2 {% if state.1 %} ball {% endif %}"></div>
                        </div>
                        <div class="cell">
                        <div class="state-3 {% if state.2 %} ball {% endif %}"></div>
                        </div>
                        </div>

                        <div class="card-text">
                        Otherwise, you will win {{ 0|c }}.
                </div>

                <button type="button" class="draw btn btn-primary mt-2">Draw a ball</button>

                <div class="container px-0 mt-2">
                    <div class="row">
                        <div class="col-8">
                            The ball drawn is:
                        </div>
                        <div class="col font-weight-bold">
                            <span id="ballDrawnColour"></span>
                        </div>
                    </div>
                </div>

            {% elif payment_type == 'DOW' %}
                <p class="card-text">
                    On the day after {{ session.vars.DOW_date }}, we will check on
                    <a href="https://finance.yahoo.com/quote/%5EDJI/history/">Yahoo Finance</a> how the Dow has evolved by comparing
                    the opening price in the column 'Open' and the closing price in the column 'Close*' and using the formula: <br>
                    Percentage change = <span class="frac">
                    <span>closing price - opening price</span>
                    <span class="symbol">/</span>
                    <span class="bottom">opening price</span>
                </span>
                </p>
            {% endif %}
        </div>
    </div>

    <div class="mt-3">
        {% next_button %}
    </div>
{% endblock %}


